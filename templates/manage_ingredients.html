{% extends "base.html" %}
{% block content %}
<h2>Ingrediënten Beheren</h2>
<p>Voeg nieuwe ingrediënten toe of bekijk bestaande ingrediënten.</p>

<div class="search-filter">
    <input type="text" id="ingredientSearch" class="form-control" 
           placeholder="Zoek ingrediënt..." style="max-width: 300px; display: inline-block;">
    <select id="categoryFilter" class="form-control" style="max-width: 200px; display: inline-block; margin-left: 10px;">
        <option value="">Alle categorieën</option>
        {% for categorie in unieke_categorieen %} 
            <option value="{{ categorie }}">{{ categorie }}</option>
        {% endfor %}
    </select>
</div>

<!-- Ingrediënten tabel -->
<table class="ingredient-table" border="1" cellpadding="5" cellspacing="0">
    <tr>
        <th>Ingrediënt</th>
        <th>Categorie</th>
        <th>Eenheid</th>
        <th>Leverancier</th>
        <th class="col-price">Prijs per eenheid</th>
        <th class="col-actions">Acties</th>
    </tr>
    {% for ingredient in ingredienten %}
    <tr>
        <td>{{ ingredient.naam }}</td>
        <td>{{ ingredient.categorie }}</td>
        <td>{{ ingredient.eenheid }}</td>
        <td>{{ ingredient.leverancier_naam or 'Geen leverancier' }}</td>
        <td class="col-price">€ {{ "%.2f"|format(ingredient.prijs_per_eenheid|float) }}</td>
        <td class="col-actions">
            <div class="ingredient-actions">
                <a href="{{ url_for('edit_ingredient', chef_naam=chef_naam, ingredient_id=ingredient.ingredient_id) }}" 
                   class="btn-action btn-edit" title="Bewerken"><i class="fas fa-edit"></i></a>
                <form method="POST" action="{{ url_for('delete_ingredient', chef_naam=chef_naam, ingredient_id=ingredient.ingredient_id) }}" 
                      style="display: inline;" 
                      onsubmit="return confirm('Weet u zeker dat u dit ingrediënt wilt verwijderen?');">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <button type="submit" class="btn-action btn-delete" title="Verwijderen"><i class="fas fa-trash-alt"></i></button>
                </form>
            </div>
        </td>
    </tr>
    {% endfor %}
</table>

<!-- Nieuw ingrediënt formulier -->
<div class="add-ingredient-form" style="margin-top: 20px;">
    <h3>Nieuw Ingrediënt Toevoegen</h3>
    <form method="POST" class="ingredient-form">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <div class="form-group">
            <input type="text" name="naam" placeholder="Naam" required class="form-control">
            <input type="text" name="categorie" placeholder="Categorie" required class="form-control">
            <input type="text" name="eenheid" placeholder="Eenheid (bijv. gram, ml)" required class="form-control">
            <input type="number" name="prijs_per_eenheid" placeholder="Prijs per eenheid" step="0.01" required class="form-control">
            <select name="leverancier" class="form-control">
                <option value="">Kies leverancier (optioneel)</option>
                {% for leverancier in leveranciers %}
                    <option value="{{ leverancier.naam }}">{{ leverancier.naam }}</option>
                {% endfor %}
            </select>
        </div>
        <button type="submit" class="btn-action"><i class="fas fa-plus"></i> Toevoegen</button>
    </form>
</div>
<!-- CSV import sectie -->
<div class="csv-import" style="margin-top: 20px;">
    <h3>Bulk Import via CSV</h3>
    <form method="POST" action="{{ url_for('bulk_add_ingredients', chef_naam=chef_naam) }}" enctype="multipart/form-data">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <div class="form-group">
            <input type="file" name="csv_file" accept=".csv" required class="form-control">
        </div>
        <button type="submit" class="btn-action"><i class="fas fa-file-import"></i> Importeren</button>
        <a href="{{ url_for('download_csv_template') }}" class="btn-action">
            <i class="fas fa-download"></i> Download Template
        </a>
    </form>
</div>

<div class="navigation-buttons">
    <a href="{{ url_for('dashboard', chef_naam=chef_naam) }}" class="btn-action">
        <i class="fas fa-arrow-left"></i> Dashboard
    </a>
</div>

<style>
    /* Hergebruik bestaande stijlen van all_dishes.html */
    .search-filter {
        background-color: #073642;
        padding: 15px;
        border-radius: 4px;
        margin-bottom: 20px;
    }
    
    .search-filter input,
    .search-filter select,
    .form-control {
        background-color: #002b36;
        color: #fff;
        border: 1px solid #586e75;
        padding: 8px;
        margin: 5px 0;
    }

    .ingredient-table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 20px;
    }

    .ingredient-table th {
        background-color: #073642;
        padding: 12px;
        text-align: left;
    }

    .ingredient-table td {
        padding: 10px;
        border: 1px solid #586e75;
    }

    /* Extra stijlen voor formulieren */
    .form-group {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }

    .form-group input {
        flex: 1;
        min-width: 200px;
    }

    .add-ingredient-form,
    .csv-import {
        background-color: #073642;
        padding: 20px;
        border-radius: 4px;
        margin-top: 20px;
    }

    h3 {
        margin-top: 0;
        color: #93a1a1;
    }
</style>

<script>
    // Zoek en filter functionaliteit
    document.addEventListener('DOMContentLoaded', function() {
        const searchInput = document.getElementById('ingredientSearch');
        const categoryFilter = document.getElementById('categoryFilter');
        const table = document.querySelector('.ingredient-table');
        const rows = table.getElementsByTagName('tr');

        function filterTable() {
            const searchTerm = searchInput.value.toLowerCase();
            const category = categoryFilter.value.toLowerCase();

            for (let i = 1; i < rows.length; i++) {
                const row = rows[i];
                const name = row.cells[0].textContent.toLowerCase();
                const rowCategory = row.cells[1].textContent.toLowerCase();
                
                const matchesSearch = name.includes(searchTerm);
                const matchesCategory = category === '' || rowCategory === category;

                row.style.display = matchesSearch && matchesCategory ? '' : 'none';
            }
        }

        searchInput.addEventListener('input', filterTable);
        categoryFilter.addEventListener('change', filterTable);
    });
</script>
{% endblock %}
