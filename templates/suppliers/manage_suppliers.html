<!-- Change the form to use onsubmit for validation instead of onclick -->
<form method="post" action="{{ url_for('ingredients_import.import_from_system_supplier', supplier_id=supplier.leverancier_id) }}"
      onsubmit="return validateAndDisableSubmit(this)">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    <input type="hidden" name="supplier_id_value" value="{{ supplier.leverancier_id|default('null') }}">
    <button type="submit" class="btn btn-primary" id="import-button-{{ supplier.leverancier_id }}">Importeer</button>
</form>

<script>
// Track which forms have been submitted to prevent double submission
var submittedForms = {};

function validateAndDisableSubmit(form) {
    // Get supplier ID from hidden field
    var supplierId = form.querySelector('input[name="supplier_id_value"]').value;
    
    // Check if supplier ID is valid
    if (!supplierId || supplierId === "null") {
        alert("Geen geldige leverancier geselecteerd.");
        return false;
    }
    
    // Check if this form was already submitted
    var formId = 'supplier-' + supplierId;
    if (submittedForms[formId]) {
        console.log('Preventing duplicate submission for supplier ' + supplierId);
        return false;
    }
    
    // Mark form as submitted
    submittedForms[formId] = true;
    
    // Disable the submit button to prevent double clicks
    var submitButton = form.querySelector('button[type="submit"]');
    if (submitButton) {
        submitButton.disabled = true;
        submitButton.innerHTML = 'Bezig met importeren...';
    }
    
    return true;
}
</script>
